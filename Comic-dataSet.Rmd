---
title: "COMICDATASET"
author: "Grupo 1 - DataScience"
date: "2/15/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
#librerias base
library(tidyverse)
library(readr)
library(lubridate)
```

## Lectura Inicial de los archivos del DataSet


Cargamos los dataset en dos dataframes DC y Marvel, y luego agregamos una columna con el nombre de la marca, previo a su fusion en un archivo llamado allcomics

```{r comics}

cor2 = function(df){
  
  stopifnot(inherits(df, "data.frame"))
  stopifnot(sapply(df, class) %in% c("integer"
                                     , "numeric"
                                     , "factor"
                                     , "character"))
  
  cor_fun <- function(pos_1, pos_2){
    
    # both are numeric
    if(class(df[[pos_1]]) %in% c("integer", "numeric") &&
       class(df[[pos_2]]) %in% c("integer", "numeric")){
      r <- stats::cor(df[[pos_1]]
                      , df[[pos_2]]
                      , use = "pairwise.complete.obs"
      )
    }
    
    # one is numeric and other is a factor/character
    if(class(df[[pos_1]]) %in% c("integer", "numeric") &&
       class(df[[pos_2]]) %in% c("factor", "character")){
      r <- sqrt(
        summary(
          stats::lm(df[[pos_1]] ~ as.factor(df[[pos_2]])))[["r.squared"]])
    }
    
    if(class(df[[pos_2]]) %in% c("integer", "numeric") &&
       class(df[[pos_1]]) %in% c("factor", "character")){
      r <- sqrt(
        summary(
          stats::lm(df[[pos_2]] ~ as.factor(df[[pos_1]])))[["r.squared"]])
    }
    
    # both are factor/character
    if(class(df[[pos_1]]) %in% c("factor", "character") &&
       class(df[[pos_2]]) %in% c("factor", "character")){
      r <- lsr::cramersV(df[[pos_1]], df[[pos_2]], simulate.p.value = TRUE)
    }
    
    return(r)
  } 
  
  cor_fun <- Vectorize(cor_fun)
  
  # now compute corr matrix
  corrmat <- outer(1:ncol(df)
                   , 1:ncol(df)
                   , function(x, y) cor_fun(x, y)
  )
  
  rownames(corrmat) <- colnames(df)
  colnames(corrmat) <- colnames(df)
  
  return(corrmat)
}


#carga de los archivos
getwd()
dir()
dc <- read.csv("dc-wikia-data.csv")

#TRATAMIENTO DE COLUMNAS TIPO STRING
dc$name <- as.character(dc$name)
dc$urlslug <- as.character(dc$urlslug)
dc$FIRST.APPEARANCE <- as.character(dc$FIRST.APPEARANCE)

#ADICION DE COLUMNA DE LA MARCA DEL COMIC, 0 DC, 1 para MARVEL
dc$BRAND <- 0


#AGREGA COLUMNA CON EL PARSEO DE FECHA DE APARICION DE STRING A DATE
dc$FECHA.APARICION<-parse_date_time(dc$FIRST.APPEARANCE, orders = c("Yb"))
dc$FECHA.APARICION <- as.Date(dc$FECHA.APARICION)

#AGREGA COLUMNA CON EL PARSEO MES DE APARICION
dc$MES.APARICION <- ymd(dc$FECHA.APARICION) %>% 
   lubridate::month(label = TRUE, abbr = FALSE)

#AGREGA COLUMNA CON EL PARSEO TRIMESTRE DE APARICION
dc$TRIMESTRE.APARICION<- ymd(dc$FECHA.APARICION) %>%
   lubridate::quarter()  # Grab quarter.

#TRATAMIENTO DE FECHAS VACIAS EN FIRST APPEARANCE y en YEAR
which(is.na(dc$FIRST.APPEARANCE))
dc$FIRST.APPEARANCE[is.na(dc$FIRST.APPEARANCE)] <- '#NA'
dc$FIRST.APPEARANCE[dc$FIRST.APPEARANCE==''] <- '#NA'

which(is.na(dc$YEAR))
dc$YEAR[is.na(dc$YEAR)] <- '#NA'
dc$YEAR[dc$YEAR==''] <- '#NA'


marvel <- read.csv("marvel-wikia-data.csv")
marvel$name <- as.character(marvel$name)
marvel$urlslug <- as.character(marvel$urlslug)
marvel$FIRST.APPEARANCE <- as.character(marvel$FIRST.APPEARANCE)


#ADICION DE COLUMNA DE LA MARCA DEL COMIC, 1 para marvel
marvel$BRAND <- 1


#AGREGA COLUMNA CON EL PARSEO DE FECHA DE APARICION DE STRING A DATE
marvel$FECHA.APARICION<-parse_date_time2(marvel$FIRST.APPEARANCE,"by", cutoff_2000 = 20)
marvel$FECHA.APARICION <- as.Date(marvel$FECHA.APARICION)

#AGREGA COLUMNA CON EL PARSEO MES DE APARICION
marvel$MES.APARICION <- ymd(marvel$FECHA.APARICION) %>% 
   lubridate::month(label = TRUE, abbr = FALSE)

#AGREGA COLUMNA CON EL PARSEO TRIMESTRE DE APARICION
marvel$TRIMESTRE.APARICION<- ymd(marvel$FECHA.APARICION) %>%
   lubridate::quarter()  # Grab quarter.


#mostrar estructura de los dataframes
str(dc)
str(marvel)

#mostrar summary con datos estadisticos de los dataframe
summary(dc)
summary (marvel)

#mostrar breve resumen de los dataframes
head(dc)
head(marvel)

#mostrar los dataframes completos
View(dc)
view (marvel)

#ELIMINACION DE COLUMNAS DISCORDANTES
names(marvel) <- names(dc) 

#JOIN DE DATAFRAMES MARVEL Y DC, sin columna FIRST APPEARRANCE por tener formato discordante, la fecha ya fue unificada como FECHA.INICIO

allcomics<-rbind(dc[,-12],marvel[,-12])

#FALTA CREAR VARIABLE PARA LA DECADA
floor_decade    = function(value){ return(value - value %% 10) }
allcomics$YEAR.APARICION <- allcomics$YEAR 
allcomics$YEAR.APARICION <- as.numeric(allcomics$YEAR.APARICION)

#which(is.na(allcomics$YEAR.APARICION))
allcomics$YEAR.APARICION[is.na(allcomics$YEAR.APARICION)] <- 0
allcomics$YEAR.APARICION[allcomics$YEAR.APARICION==''] <- 0

#CANTIDAD DE PERSONAJES SIN AÃ±O DE APARICION 
length(which(allcomics$YEAR.APARICION==0))

allcomics$DECADA.APARICION <- floor_decade(allcomics$YEAR.APARICION)

#ESCRITURA A DISCO
write.csv(allcomics, file = 'allcomics-wikia-data.csv', row.names=FALSE)

#LECTURA DE NUEVO DATASET FULL
fulldata <- read.csv("allcomics-wikia-data.csv")
fulldata$name <- as.character(fulldata$name)
fulldata$urlslug <- as.character(fulldata$urlslug)
fulldata$HAIR <- as.numeric(fulldata$HAIR)

#ASIGNACION DE NA A VALORES NULOS
fulldata$TRIMESTRE.APARICION[fulldata$TRIMESTRE.APARICION==0] <- NA
fulldata$YEAR.APARICION[fulldata$YEAR.APARICION==0] <- NA
fulldata$DECADA.APARICION[fulldata$DECADA.APARICION==0] <- NA

str(fulldata)
view(fulldata)

#cov(fulldata[,1,16])

#cor2(fulldata)

#cor(fulldata$APPEARANCES, fulldata$ID, use = 'complete.obs', method="spearman")
#cor(fulldata$ALIGN, fulldata$ID, use = 'complete.obs', method="spearman")


hist(fulldata$HAIR)

#cor(fulldata$APPEARANCES, fulldata$name, use = 'complete.obs', method="spearman")
plot(fulldata$BRAND,fulldata$APPEARANCES)
hist(fulldata$BRAND)


cor(fulldata$APPEARANCES, fulldata$TRIMESTRE.APARICION, use = 'complete.obs', method="spearman")
plot(fulldata$TRIMESTRE.APARICION, fulldata$APPEARANCES)
hist(fulldata$TRIMESTRE.APARICION)


cor(fulldata$APPEARANCES, fulldata$YEAR.APARICION, use = 'complete.obs', method="spearman")
plot(fulldata$YEAR.APARICION, fulldata$APPEARANCES)
hist(fulldata$YEAR.APARICION)

cor(fulldata$APPEARANCES, fulldata$DECADA.APARICION, use = 'complete.obs', method="spearman")
plot(fulldata$DECADA.APARICION, fulldata$APPEARANCES)
hist(fulldata$DECADA.APARICION)

cov(fulldata$APPEARANCES, fulldata$TRIMESTRE.APARICION, use = 'complete.obs')
cov(fulldata$APPEARANCES, fulldata$YEAR.APARICION, use = 'complete.obs')
cov(fulldata$APPEARANCES, fulldata$DECADA.APARICION, use = 'complete.obs')



fulldata$YEAR.APARICION <- as.factor(fulldata$YEAR.APARICION)
fulldata$DECADA.APARICION <- as.factor(fulldata$DECADA.APARICION)


```

## Including Plots

You can also embed plots, for example:

```{r graficos, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
